#!/usr/bin/env node

var spawn = require('child_process').spawn;
var exists = require('fs').existsSync;
var program = require('commander');
var pkg = require('../package');
var join = require('path').join;

/**
 * Program
 */

program
  .usage('<command> [path] [options]')
  .version(pkg.version);

/**
 * Help
 */

program.on('--help', function(){
  console.log('  Commands:')
  console.log();
  console.log('    browser   [path] [name]   run the tests using your browser');
  console.log('    saucelabs [path]          run the tests using saucelabs');
  console.log('    phantomjs [path]          run the tests using phantomjs');
  console.log();
  process.exit(0);
});

/**
 * Parse
 */

program.parse(process.argv);

/**
 * Command
 */

var cmd = program.args[0];
if (!cmd) program.help();

/**
 * Path
 */

var path = program.args[1] || '/test';

/**
 * Bin
 */

var bin = join(__dirname, 'duo-test-' + cmd);

/**
 * Args
 */

var args = ['--harmony-generators', bin].concat(process.argv.slice(3));

/**
 * Run
 */

if (!exists(bin)) {
  console.error();
  console.error('  duo-test-%s was not found', cmd);
  console.error();
  process.exit(1);
}

var proc = spawn('node', args, { stdio: 'inherit', customFds: [0, 1, 2] });
proc.on('close', function(code){
  process.exit(code);
});
